<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        body {
            background-color: #909090;
        }
    </style>
</head>
<body>
    <h1>Encrypt/Decrypt</h1>
    <p>Using WCA</p>
</body>
<script>

const myData = '0123456789abcdefghijklmnopqrstuvwxyz';
const ivInput = 'foo';
const iv = ivInput + ivInput + ivInput + ivInput;
console.log(iv);
const ivTest2 = new TextEncoder('utf-8').encode(iv);

const keyInput = 'abcdefghabcdefghabcdefgh';

async function makeKey(keyInput) {
    const keyBase64 = btoa(keyInput);
    console.log('keyBase64: ', keyBase64);
    const keyBuffer = new Uint8Array(keyBase64.length);
    for (let i = 0; i < keyBase64.length; i++) {
        keyBuffer[i] = String.fromCharCode(keyBase64.charCodeAt(i));
    }
    console.log('buffer: ', keyBuffer.length);
    const cryptoKey = await window.crypto.subtle.importKey(
        'raw',
        keyBuffer,
        { name: 'AES-GCM', length: 256 },
        true,
        ['encrypt', 'decrypt']
    );
    return cryptoKey;
};

async function encryptData(message, keyInput) {
    const resolvedKey = await makeKey(keyInput);
    const encodedMessage = new TextEncoder().encode(message);
    const encryptedData = await window.crypto.subtle.encrypt(
        {
            name: "AES-GCM",
            iv: ivTest2
        },
        resolvedKey,
        encodedMessage
    )
    .then((encrypted) => {
        console.log(new TextDecoder('utf-8').decode(encrypted));
        // decryptData(key, encrypted);
    })
    .catch((error) => {
        console.error("Error encrypting data:", error);
    });
    return encryptedData;
}

// window.crypto.subtle.generateKey(
//     {
//         name: "AES-GCM",
//         length: 256,
//     },
//     true,
//     ["encrypt", "decrypt"]
// )
// .then((key) => {
//         encryptData(myData, key);
//     })
// .catch((error) => {
//     console.error("Error generating key:", error);
// });


// Decrypt data
async function decryptData(key, encrypted) {
    const decryptedDate = await window.crypto.subtle.decrypt(
        {
        name: "AES-GCM",
        iv: ivTest2
        },
        key,
        encrypted
    )
    .catch((error) => {
        console.error("Error decrypting data:", error);
    });
    return decryptedData;
}

const encData = encryptData(myData, keyInput);

</script>
</html>